# vim:tw=0:ts=2:sw=2:et:norl
# Author: Landon Bouma <https://tallybark.com/>
# Project: https://github.com/doblabs/easy-as-pypi#ðŸ¥§
# License: MIT

---

name: CI tag specialist

on:
  workflow_call:
    inputs:
      inhibit-cascade:
        type: string
        required: false
      inhibit-cascade-always:
        type: string
        required: false

    # Maps workflow outputs to job outputs.
    outputs:
      old-inhibit-cascade:
        description: "The old ci-inhibit-cascade value"
        value: ${{ jobs.manage-ci-tags.outputs.old-inhibit-cascade }}
      old-inhibit-cascade-always:
        description: "The old ci-inhibit-cascade-always value"
        value: ${{ jobs.manage-ci-tags.outputs.old-inhibit-cascade-always }}

# ***

jobs:

  manage-ci-tags:
    name: CI tags

    runs-on: ubuntu-latest

    # Maps job outputs to step outputs.
    outputs:
      old-inhibit-cascade: "${{
        steps.manage-ci-tag.outputs.old_inhibit_cascade
      }}"
      old-inhibit-cascade-always: "${{
        steps.manage-ci-tag.outputs.old_inhibit_cascade_always
      }}"

    steps:
      - name: Checkout repo @ ${{ inputs.head-ref }}
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}
          # For 'branch' tags, fetch all history, for `git branch --list`.
          fetch-depth: 1
          # To fetch tags, either fetch-depth=0, and/or fetch-tags=true.
          fetch-tags: true

      # ***

      - name: Wrangle CI tags
        id: wrangle-ci-tags
        run: |
          ./.github/bin/wrangle-tags
        env:
          EAPP_INHIBIT_CASCADE: ${{ inputs.inhibit-cascade }}
          EAPP_INHIBIT_CASCADE_ALWAYS: ${{ inputs.inhibit-cascade-always }}
